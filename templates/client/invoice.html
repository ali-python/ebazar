{% extends 'base.html' %}
{% block title %} Home {% endblock %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col-lg-12" style="margin:30px 0">
            <div class="card text-dark">
                <div class="card-body">
                    <!--                    <h1>client : {{request.user.username}}</h1>-->
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <h1>Invoice</h1>
                        </div>
                        <br>
                        <div class="col-md-12">
                            {% if invoice.state == 'Pending' %}
                                <div class="confirmation-btn pull-right"><button class="btn btn-success pull-right confirm_btn">Confirm Payment</button></div>
                            {% else %}
                                <div class="confirmation-btn pull-right">Your Order is Confirmed!</div>
                            {% endif %}
                            <div class="row">
                                <div class="col-xs-6 col-md-6">
                                    <label><strong> Name:</strong></label> <span style="margin: 15px;">{{request.user.username|title}}</span><br>
                                    <label><strong> Phone:</strong></label> <span style="margin: 15px;">{{invoice.order.customer_phone}}</span><br>
                                    <label><strong> Address:</strong></label> <span style="margin: 15px;">{{request.user.user_profile.address}}</span><br>
                                    <label><strong> City:</strong></label> <span style="margin: 15px;">{{invoice.order.city.city_name|title}}</span><br>
                                    <label><strong>Date:</strong></label><span style="margin: 15px;">{{invoice.order.date_created}}</span><br>
                                    <br>
                                </div>
                            </div>
                            <span style="float: right; font-size: large">Receipt No. <span style="color:red">{{invoice.receipt_no}}</span></span>
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                    <tr class="item-row">
                                        <th>Price</th>
                                        <th>Quantity</th>
                                        <th>Total</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        {% for item in order_items %}
                                        <td>{{ item.item_price }}</td>
                                        <td>{{ item.item_quantity }}</td>
                                        {% endfor %}
                                        <td>{{invoice.amount}}</td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr style="border-top: 3px solid">
                                        <td></td>
                                        <td class="text-right"><strong>State</strong></td>
                                        <td class="invoice-state">{{invoice.state}}</td>
                                    </tr>
                                    <tr>
                                        {% for item in order_items %}
                                        <td><strong>Total Quantity: </strong><span id="totalQty" style="color: red; font-weight: bold">{{ item.item_quantity }}</span> Units</td>
                                        {% endfor %}
                                        <td class="text-right"><strong>Discount</strong></td>
                                        <td>0</td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td class="text-right"><strong>Shipping</strong></td>
                                        <td>0</td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td class="text-right"><strong>Grand Total</strong></td>
                                        <td><span id="grandTotal" style="color: red;">21900</span></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td class="text-right"><strong>Received Amount</strong></td>
                                        <td><span id="receivedAmount">0</span></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td class="text-right"><strong>Remaining Payment</strong></td>
                                        <td><span id="remainingAmount">21900</span></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <br>
                            {% if invoice.state == 'Pending' %}
                                <div class="confirmation-btn pull-right"><button class="btn btn-success pull-right confirm_btn">Confirm Payment</button></div>
                            {% else %}
                                <div class="confirmation-btn pull-right">Your Order is Confirmed!</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
 <script>
        $('.confirm_btn').on ('click', function (){

            $.post("{% url 'client:invoice_state_confirmed' %}", {
                invoice_id: '{{ invoice.id }}',
                csrfmiddlewaretoken: '{{ csrf_token }}',
            },function(result, status){
                if (result.invoice_state == 'Confirmed') {
                    $('.confirmation-btn').html('Your Order is Confirmed!');
                    $('.invoice-state').html(result.invoice_state);
                }
            });

            Swal.fire(
              'Thank You!',
              'For using  JatHub, our support team will contact you soon',
              'success'
            )
        });


    </script>
{% endblock %}